# Fishing Session - 2025-12-19

## Session Goal
Train fishing from level 15 to level 45 at Draynor fishing spot (shrimp/anchovies).

## Current Progress
- Started: Level 15 (initially), resumed at Level 22
- Current: Level 25, XP: 8,250 / 61,512 (13.4% to level 45)
- Location: Draynor Village fishing spot (3087, 3228)

## High-Level Observations

### Navigation Issues
- **Bank exit stuck detection**: Navigation from bank to fishing spot frequently triggers "stuck detection" (mean speed < 3.0 tiles). Seems to happen when bank interface is still open or player gets blocked by NPCs/terrain near the bank building.
- **Workaround**: Using intermediate waypoints helps. Navigate to (3088, 3235) first before going to fishing spot (3086, 3231).
- **Bank interface blocking**: Sometimes BANK_CLOSE doesn't fully register, leaving the interface open and blocking movement. Need to explicitly close bank before navigating.

### Fishing Spot Interaction
- **Viewport bounds issue**: When player is too far from fishing spot (13+ tiles), the NPC interaction system reports "outside viewport bounds" and can't click the fishing spot. The FISH command needs the player to be closer.
- **Workaround**: Navigate closer to fishing spot before issuing FISH command, or use FISH command which should handle walking to spot (but currently has issues when too far).

### Click Lag Investigation
- **Root cause identified**: `clickMenuEntrySafe()` in PlayerHelpers.java uses blocking `CountDownLatch.await()` calls
  - Line 5024: `menuClickLatch.await(1, TimeUnit.SECONDS)` - blocks up to 1 second
  - Line 5086: `refetchLatch.await(2, TimeUnit.SECONDS)` - blocks up to 2 seconds
- **Symptom**: When user manually left-clicks while bot is running, the game lags
- **Status**: Not yet fixed, documented for future improvement

### Random Events
- Seeing random event NPCs spawning near player (Mysterious Old Man, Postie Pete, Evil Bob, Capt' Arnav, etc.)
- Currently not handling them - they seem to despawn on their own
- May need handling if they become problematic

## Things That Work Well
- Banking sequence (BANK_OPEN, BANK_DEPOSIT_ALL, BANK_WITHDRAW, BANK_CLOSE) works reliably when close to bank
- Fishing at the spot works well once player is positioned correctly
- Human-like mouse movement (Bezier curves) in Mouse.java

## Things To Fix
1. Navigation stuck detection is too aggressive (threshold 3.0 tiles may be too high)
2. FISH command should walk player closer before attempting to click if spot is out of viewport
3. CountDownLatch blocking causing UI lag on manual clicks
4. Consider adding random event dismissal
5. **CRITICAL: FISH_DROP drop functionality broken** - Multiple background threads conflict when dropping items. Error at `PlayerHelpers.java:12193` in `handleDropItem()`. Logs show "Error dropping item" and "Dropped 0 items total". Inventory gets stuck at 28/28.

## Session Stats
- Trips completed: 7 (and counting)
- Level ups this session: 15->25 (10 levels)
- XP gained this session: ~6,250 (started at ~2,000)
