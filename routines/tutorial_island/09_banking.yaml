# Tutorial Island - Part 9: Banking
# STATUS: VALIDATED (2026-01-18)
#
# This routine handles the Banking section:
# 1. Climb ladder to banking area
# 2. Climb down to bank floor
# 3. Use bank booth
# 4. Close bank
# 5. Use poll booth
# 6. Close poll booth
# 7. Exit through door to chapel

name: "Tutorial Island - Banking"
type: tutorial
phase: 9

# Key Locations (VALIDATED)
locations:
  from_combat_ladder: {x: 3123, y: 3128, plane: 0}  # Ladder from combat area
  bank_roof: {x: 3123, y: 3127, plane: 1}  # After climbing up
  bank_floor: {x: 3123, y: 3127, plane: 0}  # After climbing down
  bank_booth: {x: 3120, y: 3123, plane: 0}  # Bank booth area
  poll_booth: {x: 3119, y: 3121, plane: 0}  # Poll booth location
  exit_door_position: {x: 3124, y: 3124, plane: 0}  # Walk here before opening door
  exit_door: {x: 3125, y: 3124, plane: 0}  # Door to Account Guide room

# Key Objects (VALIDATED)
objects:
  bank_booth:
    name: "Bank booth"
    id: unknown
    action: "Use"
  poll_booth:
    name: "poll"  # NOTE: Search uses "poll", menu shows "Poll booth"
    id: 26815
    action: "Use"

steps:
  # Phase 1: Navigate to banking area
  - id: 1
    description: "Open door to ladder area"
    action: INTERACT_OBJECT
    args: "Door Open"
    status: "VALIDATED"
    notes: "Door at (3124, 3126) blocks access to ladder"

  - id: 2
    description: "Climb ladder up to roof"
    action: INTERACT_OBJECT
    args: "Ladder Climb-up"
    await_condition: "plane:1"
    status: "VALIDATED"
    notes: "Ladder at (3123, 3128)"

  - id: 3
    description: "Climb ladder down to bank floor"
    action: INTERACT_OBJECT
    args: "Ladder Climb-down"
    await_condition: "plane:0"
    status: "VALIDATED"
    notes: "Climb down immediately after climbing up"

  # Phase 2: Use bank
  - id: 4
    description: "Use bank booth"
    action: INTERACT_OBJECT
    args: "Bank_booth Use"
    status: "VALIDATED"
    notes: "Opens bank interface, tutorial dialogue appears"

  - id: 5
    description: "Close bank interface"
    action: KEY_PRESS
    args: "Escape"
    status: "VALIDATED"

  # Phase 3: Use poll booth
  - id: 6
    description: "Use poll booth"
    action: INTERACT_OBJECT
    args: "poll Use"
    status: "VALIDATED"
    notes: "Object name is 'poll', not 'Poll booth' or 'Poll_booth'"

  - id: 7
    description: "Advance poll dialogue"
    action: KEY_PRESS
    args: "space"
    repeat_until: "poll_interface_open"
    status: "VALIDATED"
    notes: "Press space multiple times until poll interface opens"

  - id: 8
    description: "Close poll interface"
    action: KEY_PRESS
    args: "Escape"
    status: "VALIDATED"

  # Phase 4: Exit to Account Guide room
  - id: 9
    description: "Walk to door in front of Account Guide room"
    action: GOTO
    args: "3124 3124 0"
    status: "VALIDATED"
    notes: "Must walk to door position before clicking - multiple doors nearby!"

  - id: 10
    description: "Open door to Account Guide room"
    action: INTERACT_OBJECT
    args: "Door Open"
    status: "VALIDATED"
    notes: "Door at (3125, 3124) leads to Account Guide"

# PITFALLS DISCOVERED:
# 1. Bank booth is on plane 0, but you arrive on plane 1 after climbing up
#    FIX: Must climb down ladder immediately after climbing up
# 2. Poll booth object name is "poll" (lowercase, no "booth")
#    The menu shows "Poll booth" but scan_tile_objects finds "poll"
# 3. Dialogue appears but has no "Click here to continue" button
#    These are informational panels, just interact with the objects

# WORKING PATTERNS:
# - Bank booth: INTERACT_OBJECT Bank_booth Use
# - Poll booth: INTERACT_OBJECT poll Use
# - Close interfaces: KEY_PRESS Escape
# - Advance dialogue: KEY_PRESS space
