# Tutorial Island - Part 3: Survival Expert (Fishing & Skills)
# STATUS: VALIDATED 2026-01-25
#
# This routine handles the Survival Expert section:
# 1. Walk to Survival Expert (IMPORTANT: range limit on INTERACT_NPC)
# 2. Talk to Survival Expert
# 3. Open inventory tab
# 4. Fish shrimp
# 5. Open skills tab
# 6. Continue to woodcutting/fire-making

name: "Tutorial Island - Survival Expert"
type: tutorial
phase: 3

# Key NPCs
npcs:
  survival_expert:
    id: 8503
    location: {x: 3104, y: 3096, plane: 0}
  fishing_spot:
    id: 3317
    action: "Net"  # NOTE: Tutorial Island uses "Net" not "Small Net"!
    locations:
      - {x: 3099, y: 3090}
      - {x: 3101, y: 3092}
      - {x: 3103, y: 3092}

# Key Widgets - VALIDATED 2026-01-25
widgets:
  inventory_icon: 35913795   # Action: "Inventory"
  skills_tab: 35913793       # Action: "Skills" - VALIDATED via find_widget
  # NOTE: 35913809 (548 << 16 | 0x51) does NOT work on Tutorial Island

steps:
  - id: 1
    description: "Walk to Survival Expert area"
    action: GOTO
    args: "3100 3095 0"
    # VALIDATED: Must walk closer before INTERACT_NPC works (range limit ~10 tiles)

  - id: 2
    description: "Talk to Survival Expert"
    action: INTERACT_NPC
    args: "Survival_Expert Talk-to"
    delay_before_ms: 1000
    # NOTE: Use underscore in command args (plugin converts to space for matching)

  - id: 3
    description: "Continue dialogue (space)"
    action: KEY_PRESS
    args: "Space"
    delay_before_ms: 2000

  - id: 4
    description: "Continue dialogue (space)"
    action: KEY_PRESS
    args: "Space"
    delay_before_ms: 1000

  - id: 5
    description: "Continue dialogue (space)"
    action: KEY_PRESS
    args: "Space"
    delay_before_ms: 1000

  - id: 6
    description: "Open inventory tab"
    action: CLICK_WIDGET
    args: "35913795"
    delay_before_ms: 1000
    # Tutorial says 'click the flashing backpack icon'

  - id: 7
    description: "Walk to fishing spot"
    action: GOTO
    args: "3101 3093 0"
    # VALIDATED: Must be close to fishing spot before interaction works

  - id: 8
    description: "Fish shrimp - click fishing spot"
    action: INTERACT_NPC
    args: "Fishing_spot Net"
    delay_before_ms: 1000
    # NOTE: Use underscore. Tutorial Island uses "Net" not "Small Net"!

  - id: 9
    description: "Wait for fishing and continue dialogue"
    action: KEY_PRESS
    args: "Space"
    delay_before_ms: 5000

  - id: 10
    description: "Continue dialogue (space)"
    action: KEY_PRESS
    args: "Space"
    delay_before_ms: 1000

  - id: 11
    description: "Open skills tab"
    action: CLICK_WIDGET
    args: "35913793"
    delay_before_ms: 1000
    # VALIDATED: Widget 35913793 has action "Skills"

# KEY PRINCIPLE:
# ALWAYS use widget IDs from this file or widget_reference.yaml
# NEVER use coordinate-based clicking (send_input click x y)
# Widget commands are reliable, coordinate clicks cause disconnections

# PITFALLS DISCOVERED:
# 1. INTERACT_NPC has range limit (~10 tiles)
#    - SOLUTION: Walk closer with GOTO before INTERACT_NPC
# 2. Tutorial Island fishing spots have action "Net" not "Small Net"
# 3. Use underscore in NPC names (Survival_Expert, Fishing_spot)
#    - Plugin converts to spaces internally for matching
# 4. Skills tab widget is 35913793, NOT 10485808 or 35913809
#    - Discovered via find_widget(text="Skills")
# 5. CLICK_WIDGET works with action: CLICK_WIDGET 35913793 "Skills"

# After this routine:
# Player should have fished shrimp, opened skills tab
# Tutorial hint says: "Speak to the survival expert to continue"
# Ready for 04_woodcutting_firemaking.yaml
